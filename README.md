# wotstat-widgets

Мод для World of Tanks и Мир Танков, позволяющий добавлять плавающие веб-виджеты на экран игры.

![](/.github/hero.png)

## Возможности
- **Добавление виджетов** по URL и из локальных файлов
- **Перетаскивания виджетов** по экрану
- **Минимизация** виджета – виджет всё ещё выполняется, но не отправляется на клиент (почти не тратит ресурсов компа)
- **Изменение размера** в двух режимах, зависит от мета тега страницы
  - Произвольное изменение высоты/ширины
  - Изменение ширины, а высота подстраивается под высоту страницы
- **Блокировка виджета** – не даёт его случайно сдвинуть, делает прозрачным для кликов
- **Перезагрузка** страницы с отключенным кешем страницы
- Возможно накликать **разные размеры/позиции для боя и ангара**
- Виджеты **сохраняются при перезапуске** игры
- **DevTools** инструменты для разработчиков
- **data-provider** включен в мод

## Установка
> [!IMPORTANT]
> Работает только на x64 системах

1. Скачайте актуальную версию из [Releases](https://github.com/WOT-STAT/wotstat-widgets/releases/latest)
2. Переместите `.wotmod` файл в папку с актуальной версий игры в `Tanki/mods`. Например `Tanki/mods/1.28.0.0`
3. Запустите игру
4. В центре уведомлений появится уведомление с предложением добавить виджет ИЛИ через `Mod List`.

![](/.github/add-widget.png)

## Инструкция для разработчиков виджетов

![](/.github/cef.png)

Виджеты разрабатываются на JavaScript и являются обычными веб-страницами. Виджеты могут быть как локальными файлами, так и веб-страницами по URL.

Для получения данных из игры в этот мод уже встроен `wotstat-data-provider` – мод для передачи данных из игры в виджеты. Подробнее с ним Вы можете ознакомиться в его [репозитории](https://github.com/WOT-STAT/data-provider). 

Если установлено оба мода, то будет выбран `data-provider` наиболее актуальной версии.


### DevTools
Для открытия DevTools нужно создать папку `/mods/configs/wotstat.widgets` и в ней создать файл `config.cfg` с содержимым:

```json
{
  "devtools": true
}
```

Перезагрузите игру. Widgets CEF запустится отдельным консольным процессом, и для каждого добавленного виджета откроется окно с `Chrome DevTools`.

![](/.github/devtools.png)

## Сборка мода из исходников

Сборка осуществляется с помощью `bash` скрипта `build.sh` в корне проекта.
Поддерживаются опции:
- `-v 0.0.1` - версия мода
- `-d` - отладочная сборка
- `-p` – сборка только только Python (при условии что CEF и AS3 уже собраны)
- `-s` – сборка CEF + Python (при условии что AS3 уже собран)
- `-a` – сборка AS3 + Python (при условии что CEF уже собран)

Можно комбинировать, например:
```bash
# Соберёт Python и CEF сервер, AS3 возьмёт из кеша
./build.sh -v 0.0.1 -d -ps
```


Мод состоит из трёх частей:
- Отдельный процесс `CEF сервера` на котором будут крутиться браузеры. CEF – Chromium Embedded Framework (буквально браузер Chrome с которым можно взаимодействовать через код).  
  Используется версия `v123.0.7+chromium-123.0.6312.46`. Собрана вручную из [PR#669](https://github.com/cztomczak/cefpython/pull/669) в ветке `cefpython123`.
- Мод на `Python2.7` для взаимодействия с игрой, графикой и `CEF сервером`
- Графический интерфейс на `ActionScript 3` для отображения виджетов

